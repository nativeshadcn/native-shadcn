{
  "name": "map-view",
  "type": "registry:ui",
  "description": "A map view component for React Native",
  "dependencies": [
    "react-native-maps"
  ],
  "devDependencies": [],
  "registryDependencies": [
    "utils"
  ],
  "files": [
    {
      "path": "ui/map-view.tsx",
      "content": "import * as React from 'react';\nimport { View, Text } from 'react-native';\nimport MapView, { Marker, Circle, PROVIDER_GOOGLE, Region } from 'react-native-maps';\n\nexport interface MapLocation {\n  latitude: number;\n  longitude: number;\n}\n\nexport interface MapMarkerData {\n  id: string;\n  latitude: number;\n  longitude: number;\n  title?: string;\n  description?: string;\n  distance?: number;\n  [key: string]: any;\n}\n\n// Context for sharing map state\ntype MapViewContextValue = {\n  mapRef: React.RefObject<MapView>;\n  selectedMarkerId: string | null;\n  setSelectedMarkerId: (id: string | null) => void;\n  onMarkerPress?: (markerId: string, markerData: MapMarkerData) => void;\n  markerColor: string;\n  selectedMarkerColor: string;\n};\n\nconst MapViewContext = React.createContext<MapViewContextValue | undefined>(undefined);\n\nfunction useMapView() {\n  const context = React.useContext(MapViewContext);\n  if (!context) {\n    throw new Error('MapView components must be used within <MapView>');\n  }\n  return context;\n}\n\n// Root MapView Component\ninterface MapViewRootProps extends Omit<React.ComponentPropsWithoutRef<typeof MapView>, 'children'> {\n  selectedMarkerId?: string | null;\n  onSelectedMarkerIdChange?: (id: string | null) => void;\n  onMarkerPress?: (markerId: string, markerData: MapMarkerData) => void;\n  initialRegion?: Region;\n  markerColor?: string;\n  selectedMarkerColor?: string;\n  children?: React.ReactNode;\n}\n\nconst MapViewRoot = React.forwardRef<MapView, MapViewRootProps>(\n  (\n    {\n      selectedMarkerId,\n      onSelectedMarkerIdChange,\n      onMarkerPress,\n      initialRegion,\n      markerColor = '#2563eb',\n      selectedMarkerColor = '#1e40af',\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const mapRef = React.useRef<MapView>(null);\n    const [internalSelectedId, setInternalSelectedId] = React.useState<string | null>(null);\n\n    React.useImperativeHandle(ref, () => mapRef.current as MapView);\n\n    const isControlled = selectedMarkerId !== undefined;\n    const currentSelectedId = isControlled ? selectedMarkerId : internalSelectedId;\n    const handleSelectedIdChange = isControlled ? onSelectedMarkerIdChange : setInternalSelectedId;\n\n    const contextValue = React.useMemo(\n      () => ({\n        mapRef,\n        selectedMarkerId: currentSelectedId,\n        setSelectedMarkerId: handleSelectedIdChange || (() => {}),\n        onMarkerPress,\n        markerColor,\n        selectedMarkerColor,\n      }),\n      [currentSelectedId, handleSelectedIdChange, onMarkerPress, markerColor, selectedMarkerColor]\n    );\n\n    return (\n      <MapViewContext.Provider value={contextValue}>\n        <MapView\n          ref={mapRef}\n          provider={PROVIDER_GOOGLE}\n          style={{ width: '100%', height: '100%' }}\n          initialRegion={initialRegion}\n          showsMyLocationButton={false}\n          {...props}\n        >\n          {children}\n        </MapView>\n      </MapViewContext.Provider>\n    );\n  }\n);\nMapViewRoot.displayName = 'MapView';\n\n// MapViewMarker - Individual marker\ninterface MapViewMarkerProps extends React.ComponentPropsWithoutRef<typeof Marker> {\n  id: string;\n  markerData?: MapMarkerData;\n  children?: React.ReactNode;\n}\n\nconst MapViewMarker = React.forwardRef<\n  React.ElementRef<typeof Marker>,\n  MapViewMarkerProps\n>(({ id, markerData, coordinate, children, onPress, ...props }, ref) => {\n  const { selectedMarkerId, setSelectedMarkerId, onMarkerPress, markerColor, selectedMarkerColor } = useMapView();\n  const isSelected = selectedMarkerId === id;\n\n  const handlePress = React.useCallback(\n    (e: any) => {\n      setSelectedMarkerId(id);\n      if (markerData) {\n        onMarkerPress?.(id, markerData);\n      }\n      onPress?.(e);\n    },\n    [id, markerData, setSelectedMarkerId, onMarkerPress, onPress]\n  );\n\n  // Default marker view\n  const defaultMarker = (\n    <View\n      className=\"rounded-full p-2 items-center shadow-md border-2\"\n      style={{\n        backgroundColor: isSelected ? selectedMarkerColor : '#fff',\n        borderColor: isSelected ? selectedMarkerColor : markerColor,\n      }}\n    >\n      <Text className=\"text-xl\">{isSelected ? 'üìç' : 'üìå'}</Text>\n      {markerData?.distance !== undefined && (\n        <Text\n          className=\"text-xs font-semibold mt-0.5\"\n          style={{ color: isSelected ? '#fff' : markerColor }}\n        >\n          {markerData.distance.toFixed(1)}km\n        </Text>\n      )}\n    </View>\n  );\n\n  return (\n    <Marker\n      ref={ref}\n      coordinate={coordinate}\n      onPress={handlePress}\n      {...props}\n    >\n      {children || defaultMarker}\n    </Marker>\n  );\n});\nMapViewMarker.displayName = 'MapViewMarker';\n\n// MapViewMarkers - Render multiple markers\ninterface MapViewMarkersProps {\n  data: MapMarkerData[];\n  renderMarker?: (marker: MapMarkerData, isSelected: boolean) => React.ReactNode;\n}\n\nconst MapViewMarkers = ({ data, renderMarker }: MapViewMarkersProps) => {\n  const { selectedMarkerId } = useMapView();\n\n  return (\n    <>\n      {data.map((marker) => {\n        if (!marker.latitude || !marker.longitude) return null;\n\n        const isSelected = marker.id === selectedMarkerId;\n        const coordinate = {\n          latitude: marker.latitude,\n          longitude: marker.longitude,\n        };\n\n        return (\n          <MapViewMarker\n            key={marker.id}\n            id={marker.id}\n            markerData={marker}\n            coordinate={coordinate}\n            title={marker.title}\n            description={marker.description}\n          >\n            {renderMarker?.(marker, isSelected)}\n          </MapViewMarker>\n        );\n      })}\n    </>\n  );\n};\nMapViewMarkers.displayName = 'MapViewMarkers';\n\n// MapViewUserLocation - User location marker\ninterface MapViewUserLocationProps {\n  location: MapLocation;\n  children?: React.ReactNode;\n}\n\nconst MapViewUserLocation = React.forwardRef<\n  React.ElementRef<typeof Marker>,\n  MapViewUserLocationProps\n>(({ location, children, ...props }, ref) => {\n  const defaultUserMarker = (\n    <View className=\"bg-background rounded-full p-1 shadow-lg\">\n      <Text className=\"text-2xl\">üìç</Text>\n    </View>\n  );\n\n  return (\n    <Marker\n      ref={ref}\n      coordinate={location}\n      anchor={{ x: 0.5, y: 0.5 }}\n      {...props}\n    >\n      {children || defaultUserMarker}\n    </Marker>\n  );\n});\nMapViewUserLocation.displayName = 'MapViewUserLocation';\n\n// MapViewCircle - Radius circle\ninterface MapViewCircleProps extends React.ComponentPropsWithoutRef<typeof Circle> {\n  center: MapLocation;\n  radius: number; // in kilometers\n  strokeColor?: string;\n  fillColor?: string;\n}\n\nconst MapViewCircle = React.forwardRef<\n  React.ElementRef<typeof Circle>,\n  MapViewCircleProps\n>(\n  (\n    {\n      center,\n      radius,\n      strokeColor = 'rgba(37, 99, 235, 0.5)',\n      fillColor = 'rgba(37, 99, 235, 0.1)',\n      strokeWidth = 2,\n      ...props\n    },\n    ref\n  ) => (\n    <Circle\n      ref={ref}\n      center={center}\n      radius={radius * 1000} // Convert km to meters\n      strokeColor={strokeColor}\n      fillColor={fillColor}\n      strokeWidth={strokeWidth}\n      {...props}\n    />\n  )\n);\nMapViewCircle.displayName = 'MapViewCircle';\n\n// Helper hook to fit map to coordinates\ninterface UseFitToCoordinatesOptions {\n  markers?: MapMarkerData[];\n  userLocation?: MapLocation;\n  edgePadding?: { top: number; right: number; bottom: number; left: number };\n}\n\nfunction useFitToCoordinates({\n  markers = [],\n  userLocation,\n  edgePadding = { top: 50, right: 50, bottom: 300, left: 50 },\n}: UseFitToCoordinatesOptions) {\n  const { mapRef } = useMapView();\n\n  React.useEffect(() => {\n    if (markers.length > 0 && mapRef.current) {\n      const coordinates = markers\n        .filter((m) => m.latitude && m.longitude)\n        .map((m) => ({\n          latitude: m.latitude,\n          longitude: m.longitude,\n        }));\n\n      if (userLocation) {\n        coordinates.push(userLocation);\n      }\n\n      if (coordinates.length > 0) {\n        setTimeout(() => {\n          mapRef.current?.fitToCoordinates(coordinates, {\n            edgePadding,\n            animated: true,\n          });\n        }, 100);\n      }\n    }\n  }, [markers, userLocation, edgePadding, mapRef]);\n}\n\nexport {\n  MapViewRoot as MapView,\n  MapViewMarker,\n  MapViewMarkers,\n  MapViewUserLocation,\n  MapViewCircle,\n  useFitToCoordinates,\n};\n",
      "type": "registry:ui"
    }
  ]
}